<!doctype html><html class=no-js lang=es>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Controlar las luces de Philips hue con un script en bash - Sherblog</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content="Controlar las luces de Philips hue con un script en bash">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="http://www.sherblog.pro//images/20200918_philips_hue_bash_script_00.jpg">
<meta name=twitter:title content="Controlar las luces de Philips hue con un script en bash">
<meta name=twitter:description content="Controlar las luces de Philips hue con un script en bash">
<meta name=twitter:creator content="@sherblogpro">
<meta name=twitter:site content="sherblog.pro">
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Controlar las luces de Philips hue con un script en bash">
<meta name=twitter:description content="Controlar las luces de Philips hue con un script en bash">
<div class=container>
<div class=logo>
<a class=logo__link href=/ title=Sherblog rel=home>
<div class=logo__title>Sherblog</div>
<div class=logo__tagline>Sólo mi forma de hacer las cosas...</div>
</a>
</div>
<nav class=menu>
<button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menú</span>
</button>
<ul class=menu__list>
<li class=menu__item>
<a class=menu__link href=/mis-v%C3%A9rtices-geod%C3%A9sicos/>
<span class=menu__text>Mis vértices geodésicos</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/post/computing/raspberry/>
<span class=menu__text>Raspberry Pi desde cero</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/post/android/tasker/>
<span class=menu__text>Tasker</span>
</a>
</li>
</ul>
</nav>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>Controlar las luces de Philips hue con un script en bash</h1>
<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-09-18T00:00:00Z>2020-09-18</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/computing/ rel=category>computing</a>
</span>
</div></div>
</header>
<figure class=post__thumbnail>
<img src=/images/20200918_philips_hue_bash_script_00.jpg alt="Controlar las luces de Philips hue con un script en bash">
</figure>
<div class="post__toc toc">
<div class=toc__title>Índice</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#conocer-la-ip-del-puente-de-hue>Conocer la IP del puente de Hue</a></li>
<li><a href=#crear-un-usuario-autorizado-de-acceso-al-hub>Crear un usuario autorizado de acceso al hub</a></li>
<li><a href=#conociendo-las-bombillas>Conociendo las bombillas</a></li>
<li><a href=#encendiendo-la-bombilla>Encendiendo la bombilla</a></li>
</ul>
</nav>
</div>
</div><div class="content post__content clearfix">
<p>Hay muchas formas de controlar las luces de Phillis Hue, aquí dejo la que empleo para apagar las luces mediante una simple línea de comando gracias a la Raspberry.</p>
<p>Desde que <a href=https://ifttt.com>IFTTT</a> se ha pasado al modelo de subscripción, me he visto obligado a buscar alternativas a su uso más económicas que el pago de 10€ al mes de cuota. Después de dar unas cuantas vueltas por <a href=https://github.com>GitHub</a> a la búsqueda de scripts para controlar desde la línea de comando las luces de Philips sin ningún éxito me he encontrado con que la solución era mucho más facil de lo que yo pensaba además de estar perfectamente documentada en la web del fabricante. El punto de partida es la web de desarrolladores de <a href=https://developers.meethue.com/develop/get-started-2>Philips</a> y seguir unos sencillos pasos.</p>
<h2 id=conocer-la-ip-del-puente-de-hue>Conocer la IP del puente de Hue</h2>
<p>La forma mas sencilla de conocer la IP del Bridge es sin duda desde la aplicación del teléfono, en el apartado &ldquo;Ajustes&rdquo; seleccionamos &ldquo;Hue Bridges&rdquo; y abrimos la información del puente que tengamos conectado en nuestra casa. Obtendremos la siguiente info entre la que podemos ver la IP local del puente.</p>
<p><code>Estado: Conectado Seguridad: Protegido por HTTPS ID: 001788FFFC5G7247 Dirección IP: 192.168.1.94 Dirección MAC: 01:14:68:2E:7B:AC SW: 1940083000</code></p>
<p>Resulta extraño no tener instalada la aplicación en el móvil, pero si ocurre, obtener la IP desde la terminal es tan sencillo como lanzar el comando <code>sudo nmap -sn 192.168.1.0/24</code> y buscar la IP que corresponde al punte de Philips entre todos los aparatos que tenemos conectados a nuestra red local.</p>
<p><code>Nmap scan report for 192.168.1.94 Host is up (0.00027s latency). MAC Address: 01:14:68:2E:7B:AC (Philips Lighting BV)</code></p>
<p>La imagen anterior es el resultado de nmap en la que se puede ver las ip del puente, latencia, estado, dirección MAC y fabricante.</p>
<h2 id=crear-un-usuario-autorizado-de-acceso-al-hub>Crear un usuario autorizado de acceso al hub</h2>
<p>Para poder enviar comandos al hub, lo primero que necesitamos es un usuario autorizado para lo cual pulsaremos el botón central del bridge y seguidamentemandaremos este comando desde la terminal. <code>curl -X POST -H "Content-Type: application/json" -d '{"devicetype":"my_hue_app#android usuario"}' http://192.168.1.94/api/</code> Obteniendo, si todo ha ido bien, una respuesta del tipo</p>
<p><code>[ { "success": { "username": "IUhFYVXiv46HGzc1fY46dGUpvTnhfffl0BdmEyDC" } } ]</code></p>
<p>Es posible ver toda la configuración del Hub así como los usuarios activos con el comando (Habrá que sustituir por IUhFYVXiv46HGzc1fY46dGUpvTnhfffl0BdmEyDC <code>curl -i -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://192.168.1.94/api/&lt;username>/config</code></p>
<p>Además de toda la información disponible en el Bridge puedes ver el usuario que acabas de añadir en la última línea del texto.</p>
<p><code>"IUhFYVXiv46HGzc1fY46dGUpvTnhfffl0BdmEyDC":{"last use date":"2020-09-18T08:44:33","create date":"2020-09-16T11:02:47","name":"my_hue_app#android usuario"}</code></p>
<blockquote>
<p>Es posible eliminar usuarios activos desde la web <a href=https://account.meethue.com/apps>https://account.meethue.com/apps</a></p>
</blockquote>
<h2 id=conociendo-las-bombillas>Conociendo las bombillas</h2>
<p>Antes de plantearnos la posibilidad de encender una bombilla, deberemos saber como el puente la ha identificado para lo cual lanzaremos el siguiente comando <code>curl -i -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://192.168.1.94/api/&lt;username>/lights</code></p>
<p><img src=/images/20200918_philips_hue_bash_script_01.jpg alt=Image_01></p>
<p>No te asustes de la parrafada, copia el último trozo de texto en json y pégalo en este <a href=http://jsonviewer.stack.hu>visor</a> online para darle un formato más &ldquo;humano&rdquo; tal y como se puede ver en la siguiente imagen.</p>
<p><img src=/images/20200918_philips_hue_bash_script_02.jpg alt=Image_02></p>
<p>Ahora resulta sencillo ver que la bombilla &ldquo;1&rdquo; corresponde con la que hemos llamado &ldquo;Luz de Noel&rdquo; por lo que ya estamos más cerca de poder encenderla.</p>
<h2 id=encendiendo-la-bombilla>Encendiendo la bombilla</h2>
<p>Llegados a este punto, ya tenemos la Ip donde se encuentra localizado el Hub de Pilips, el nombre el usuario autorizado y la identificación de la bombilla que queremos encender. Sólo resta lanzar un comando para encender esta bombilla <code>curl -X PUT -H "Content-Type: application/json" -d '{"on":true}' "http://&lt;ip_del_hub>/api/&lt;username>/lights/1/state"</code></p>
<blockquote>
<p>Para apagarla, tan sencillo como cambiar el true por false&mldr; Y hasta aquí lo prometido, una sola línea de comando para encender una bombilla.</p>
</blockquote>
<p>De aquí en adelante, gracias a la buena documentación de Philips, se puede hacer lo que necesitemos con esas bombillas.</p>
</div>
<footer class=post__footer>
<div class="content post__content clearfix">
<h3>Otros de mís artículos que te pueden interesar</h3>
<ul>
<li><a href=/buscar-y-reemplazar-en-bash-con-find-y-sed/>Buscar y reemplazar en bash con find y sed</a></li>
<li><a href=/clonar-el-disco-de-arranque-de-la-raspberry/>Clonar el disco de arranque de la raspberry</a></li>
<li><a href=/instalar-rclone-en-synology-ds920-/>Instalar rclone en Synology Ds920+</a></li>
<li><a href=/mi-gesti%C3%B3n-de-los-archivos-de-configuraci%C3%B3n/>Mi gestión de los archivos de configuración</a></li>
<li><a href=/montar-carpeta-del-nas-mediante-sshfs/>Montar carpeta del NAS mediante sshfs</a></li>
</ul>
</div>
<div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/bash/ rel=tag>bash</a>
</li>
<li class=tags__item>
<a class="tags__link btn" href=/tags/phillips-hue/ rel=tag>phillips hue</a>
</li>
</ul>
</div>
</footer>
</article>
</main>
<nav class="post-nav flex">
<div class="post-nav__item post-nav__item--prev">
<a class=post-nav__link href=/como-descargar-el-icono-de-un-servicio-web/ rel=prev><span class=post-nav__caption>«&#8201;Anterior</span><p class=post-nav__post-title>Como descargar el icono de un servicio web</p></a>
</div>
<div class="post-nav__item post-nav__item--next">
<a class=post-nav__link href=/mi-post-instalaci%C3%B3n-de-linux-mint/ rel=next><span class=post-nav__caption>Siguiente&#8201;»</span><p class=post-nav__post-title>Mi Post-instalación de Linux Mint</p></a>
</div>
</nav>
</div>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2022 Sherblog.
<span class=footer__copyright-credits>Generado con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> y <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span>
</div>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script></body>
</html>