<!doctype html><html class=no-js lang=es>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Instalación de Home Assistant en Raspberry - Sherblog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content="Aquí dejo las alternativas que he valorado a la hora de instalar Home Assistant en la Raspberry">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="http://www.sherblog.pro//images/20210527_raspberry_home_assistant_00.jpg">
<meta name=twitter:title content="Instalación de Home Assistant en Raspberry">
<meta name=twitter:description content="Aquí dejo las alternativas que he valorado a la hora de instalar Home Assistant en la Raspberry">
<meta name=twitter:creator content="@sherblogpro">
<meta name=twitter:site content="sherblog.pro">
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
</head><body class=body>
<div class="container container--outer">
<header class=header>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Instalación de Home Assistant en Raspberry">
<meta name=twitter:description content="Aquí dejo las alternativas que he valorado a la hora de instalar Home Assistant en la Raspberry">
<div class=container>
<div class=logo>
<a class=logo__link href=/ title=Sherblog rel=home>
<div class=logo__title>Sherblog</div><div class=logo__tagline>Sólo mi forma de hacer las cosas...</div></a>
</div><nav class=menu>
<button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menú</span>
</button>
<ul class=menu__list>
<li class=menu__item>
<a class=menu__link href=/post/computing/emacs/>
<span class=menu__text>Emacs</span>
</a>
</li><li class=menu__item>
<a class=menu__link href=/post/computing/hugo/>
<span class=menu__text>Hugo</span>
</a>
</li><li class=menu__item>
<a class=menu__link href=/mis-v%C3%A9rtices-geod%C3%A9sicos/>
<span class=menu__text>Mis vértices geodésicos</span>
</a>
</li><li class="menu__item menu__item--active">
<a class=menu__link href=/post/computing/raspberry/>
<span class=menu__text>Raspberry Pi desde cero</span>
</a>
</li></ul></nav></div></header><div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>Instalación de Home Assistant en Raspberry</h1><div class="post__meta meta">
<div class="meta__item-datetime meta__item">
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-02-11T00:00:00Z>2022-02-11</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/raspberry/ rel=category>Raspberry</a>, <a class=meta__link href=/categories/home-assistant/ rel=category>home assistant</a>
</span>
</div></div></header><figure class="post__thumbnail thumbnail">
<img class=thumbnail__image src=/images/20210527_raspberry_home_assistant_00.jpg alt="Instalación de Home Assistant en Raspberry">
</figure><div class="post__toc toc">
<div class=toc__title>Índice</div><div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#distribución-completa>Distribución completa</a></li><li><a href=#contenedor-mediante-docker>Contenedor mediante Docker</a></li><li><a href=#ha-supervisado-sobre-debian-10>HA supervisado sobre Debian 10</a></li><li><a href=#ha-supervisado-sobre-raspberry-os>HA supervisado sobre Raspberry OS</a></li><li><a href=#ha-supervisado-sobre-debian-11>HA supervisado sobre Debian 11</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix">
<p>Las dudas surgen cuando tienes varias posibilidades. Esto es lo que me ha pasado a la hora de empezar las pruebas con Home Assistant en una Raspberry Pi 4 de 4gb de ram sobre un stick usb.</p><h3 id=distribución-completa>Distribución completa</h3><p>El primer paso es acceder a la web de <a href=https://www.home-assistant.io>Home Assistant</a> y seguir los pasos de <a href=https://www.home-assistant.io/installation/raspberrypi>instalación en raspberry</a> para novatos. De esta forma se instalará la distribución completa de Home Assistant según lo siguiente.</p><ol>
<li>En el artículo de <a href=https://www.home-assistant.io/installation/raspberrypi>instalación en raspberry</a> buscamos el enlace para la versión que necesitamos</li><li>Grabar la imagen en el stick usk con <a href=https://www.balena.io/etcher/>Balena Etcher</a></li><li>Montar el stick en la raspberry, conectar cable de red y alimentación y encender</li><li>Esperamos unos minutos y ya se puede acceder a http://IP_raspberry:8123</li></ol><blockquote>
<p>Si no sabes como descubrir la IP con la que la raspberry se ha conectado a la red puedes visitar este <a href=https://sherblog.pro/raspberry-montaje-y-ssh/>post</a> para obtener alguna respuesta.</p></blockquote><p>Y ya está, de una forma rápida y sencilla tenemos la distribución de <a href=https://www.home-assistant.io>Home Assistant</a> corriendo en la Raspberry. La instalación es completamente funcional pero limita mucho el uso de la Raspberry para otros menesteres debido al Alpine Linux sobre el que está funcionando <a href=https://www.home-assistant.io>Home Assistant</a>.</p><p>Otro problema con el que me he encontrado es que la única forma de asignar una IP estática a la Raspberry es reservando la dirección desde el DHCP del router. No he sido capaz de hacerlo desde la configuración de la distribución.</p><p>Por lo anterior me decido a probar otro método de instalación que me ofrezca mejores resultados.</p><h3 id=contenedor-mediante-docker>Contenedor mediante Docker</h3><p>Necesitaremos tener instalado Docker en nuestra Raspberry para poder manejar la instalación del contenedor, para ello&mldr;</p><ol>
<li>Instalación de Raspberry OS en su versión lite (En este <a href=https://sherblog.pro/raspberry-montaje-y-ssh/>post</a> está detallado]</li><li>Instalación de Docker (En el blog de <a href=https://www.manelrodero.com/blog/instalar-docker-en-raspberry-pi-4>manelrodero</a> está descrito)</li><li>Seguir la <a href=https://www.home-assistant.io/installation/raspberrypi#install-home-assistant-container>instalación en contenedor</a></li></ol><p>Aunque es un poco más laboriosa que la anterior, esta instalación tampoco presenta mayor complicación pero tiene un gran inconveniente y es que imposibilita el uso de add-ons a través del modo &ldquo;Supervisor&rdquo; de <a href=https://www.home-assistant.io>Home Assistant</a> lo cual limita mucho las posibilidades. Simplemente por esto descarto también este tipo de instalación.</p><h3 id=ha-supervisado-sobre-debian-10>HA supervisado sobre Debian 10</h3><p>Navegando un poco por la red doy con este post de <a href=https://tecnosanvaras.es/instalacion-de-ha-supervisded-en-raspberry-pi-con-debian-10/>tecnosanvaras</a> en el se habilita el modo supervisado de <a href=https://www.home-assistant.io>Home Assistant</a> en la instalación en Docker siguiendo los siguientes pasos.</p><ol>
<li>Descargar la ultima versión de [Debian para Raspberry]</li><li>Descomprimir la imagen</li><li>Grabar la imagen en el stick usk con <a href=https://www.balena.io/etcher/>Balena Etcher</a></li><li>Conectar la Raspberry a un teclado, monitor y red cableada</li><li>Insertar el stick usb y arrancar la Raspberry</li><li>Tras el arranque, logearnos como &ldquo;root&rdquo;</li><li>Actualizar las dependencias - <code>apt update</code></li><li>Instalar sudo - <code>apt install sudo</code></li><li>Crear un nuevo usuario - <code>adduser TU_USUARIO</code></li><li>Añadir el usuario creado al grupo sudo - <code>usermod -aG sudo TU_USUARIO</code></li><li>Averiguar la IP de la Raspberry - <code>ip addr show eth0</code></li><li>Reiniciar la raspberry</li></ol><blockquote>
<p>Importante no realizar un &ldquo;apt upgrade&rdquo; de la distribución ya que, a día de hoy (20210517), presenta un bug con el aranque desde usb que hace que se cuelgue el sistema.</p></blockquote><p>Con esto ya sólo resta instalar una utilidades, docker y el supervisor de home assistant mediante las siguientes líneas de código.</p><pre tabindex=0><code>sudo -i
apt-get install -y software-properties-common apparmor-utils apt-transport-https ca-certificates curl dbus jq network-manager
systemctl disable ModemManager
systemctl stop ModemManager
curl -fsSL get.docker.com | sh
curl -sL &#34;https://raw.githubusercontent.com/Kanga-Who/home-assistant/master/supervised-installer.sh&#34; | bash -s -- -m raspberrypi4-64
</code></pre><p>Con la instalación realizada, ya estamos en condiciones de acceder a la IP que se nos muestra al terminar el script a través del puerto 8123.</p><pre tabindex=0><code>[info] 
[info] Home Assistant supervised is now installed
[info] First setup will take some time, when it&#39;s ready you can reach it here:
[info] http://192.168.1.104:8123
[info] 
</code></pre><p>Aunque el método es un poco más laborioso que los anteriores, el resultado es bueno ya que hemos obtenido una instalación de <a href=https://www.home-assistant.io>Home Assistant</a> con el modo supervisado activado sobre una distribución completamente funcional que nos permite sacar mucho más partido de la Raspberry.</p><p>Con todo presenta el problema de la imposibilidad de actualizar el sistema operativo por lo que, aunque la dejo en producción, sigo buscando una mejor alternativa.</p><h3 id=ha-supervisado-sobre-raspberry-os>HA supervisado sobre Raspberry OS</h3><p>Removiendo un poco por <a href=https://github.com>GitHub</a> doy con un artículo de <a href=https://github.com/Kanga-Who/home-assistant/blob/master/Supervised%20Install%20on%20Raspberry%20Pi%20OS.md>Kanga-Who</a> donde esplica como instalar el modo supervisado de <a href=https://www.home-assistant.io>Home Assistant</a> sobre Raspberry OS de una forma al margen de la oficial siguiendo los siguientes pasos.</p><ol>
<li>Instalación de Raspberry OS lite y habilitar el acceso ssh (En este <a href=https://sherblog.pro/raspberry-montaje-y-ssh/>post</a> está detallado]</li><li>Conectarse a la Raspberry mediante ssh</li><li>Ejecutar <code>sudo raspi-config</code> y cambiar pass, timezone y en opciones avanzadas &ldquo;A1–expand file system&rdquo;</li><li>Acualizar el sistema mediante <code>sudo apt update && sudo apt upgrade -y && sudo apt autoremove -y</code></li><li>Reiniciar mediante <code>sudo reboot</code></li><li>Desde la conexión ssh ejecutar el siguiente código</li></ol><pre tabindex=0><code>sudo -i
apt-get install -y software-properties-common apparmor-utils apt-transport-https ca-certificates curl dbus jq network-manager
systemctl disable ModemManager
systemctl stop ModemManager
curl -fsSL get.docker.com | sh
curl -sL &#34;https://raw.githubusercontent.com/Kanga-Who/home-assistant/master/supervised-installer.sh&#34; | bash -s -- -m raspberrypi4
</code></pre><p>Un poco de paciencia y al cabo de unos minutos ya podremos acceder a http://ip_raspberry:8123 para terminar con la configuración de <a href=https://www.home-assistant.io>Home Assistant</a></p><p>Definitivamente, este el mejor método que he podido encontrar hasta ahora, el único problema que presenta es que la instalación no está soportada oficialmente aunque el funcionamiento es correcto por lo que la dejo instalada.</p><h3 id=ha-supervisado-sobre-debian-11>HA supervisado sobre Debian 11</h3><p>En mi caso estoy realizando la instalación sobre una Raspberry Pi 3B+ sobre un stick usb que he configurado como método de arranque gracias a este post de <a href=https://www.instructables.com/Booting-Raspberry-Pi-3-B-With-a-USB-Drive/>instructables</a></p><ul>
<li>Desde <a href=https://raspi.debian.net/tested-images/>raspi.debian.net</a> descargamos la versión 11 para nuestra Raspberry</li><li>Quemamos la imagen en un stick usb</li><li>Conectamos el usb, un monitor y un teclado a la Raspberry</li><li>Tras el arranque nos logueamos como &ldquo;root&rdquo;</li><li>Ejecutamos los siguientes comandos para:</li><li>Actualizar y limpiar el sistema</li><li>Configurar el teclado y la consola en castellano</li><li>Establecer contraseña para el usuario &ldquo;root&rdquo;</li><li>Añadir el usuario &ldquo;pi&rdquo;</li><li>Añadir la función &ldquo;sudo&rdquo;</li><li>Añadir el usuario &ldquo;pi&rdquo; a la función &ldquo;sudo&rdquo;</li><li>Conocer la ip que se le ha asignado a la Raspberry</li><li>Reiniciar</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y <span style=color:#f92672>&amp;&amp;</span> sudo apt autoremove
</span></span><span style=display:flex><span>apt install keyboard-configuration console-setup
</span></span><span style=display:flex><span>passwd root
</span></span><span style=display:flex><span>adduser pi
</span></span><span style=display:flex><span>apt install sudo
</span></span><span style=display:flex><span>usermod -aG sudo pi
</span></span><span style=display:flex><span>ip addr show eth0 | grep <span style=color:#e6db74>&#34;inet&#34;</span>
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><ul>
<li>Ahora ya nos podemos conectar de forma remota a la Raspberry mediante <code>ssh pi@192.168.10.149</code></li></ul><p>A partir de aquí seguiremos la instalación de Home Assistant Supervisado según el post <a href=https://github.com/Kanga-Who/home-assistant/blob/master/Supervised%20on%20Raspberry%20Pi%20with%20Debian.md>Kanga-Who - HA Rpi Debian 11</a>.</p><ul>
<li>Adquirimos los privilegios de &ldquo;root&rdquo;</li><li>Reparamos dependencias no satisfechas</li><li>Instalamos &ldquo;jp&rdquo;, &ldquo;curl&rdquo;, &ldquo;avahi-daemon&rdquo;,&mldr;</li><li>Instalamos &ldquo;Docker&rdquo;</li><li>Descargamos la última versión del agente para HA</li><li>Instalamos el agente</li><li>reiniciamos el sistema</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -i
</span></span><span style=display:flex><span>apt --fix-broken install
</span></span><span style=display:flex><span>apt-get install jq curl avahi-daemon apparmor-utils udisks2 libglib2.0-bin network-manager dbus wget -y
</span></span><span style=display:flex><span>curl -fsSL get.docker.com | sh
</span></span><span style=display:flex><span>wget https://github.com/home-assistant/os-agent/releases/download/1.2.2/os-agent_1.2.2_linux_aarch64.deb
</span></span><span style=display:flex><span>dpkg -i os-agent_1.2.2_linux_aarch64.deb
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><p>Ya sólo resta instalar Home Assistant Supervisado mediante</p><ul>
<li>Adquirimos los privilegios de &ldquo;root&rdquo;</li><li>Descargamos la ultima versión de HA Supervisado</li><li>Instalamos</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/home-assistant/supervised-installer/releases/latest/download/homeassistant-supervised.deb
</span></span><span style=display:flex><span>dpkg -i homeassistant-supervised.deb
</span></span></code></pre></div><p>Se nos preguntará antes de realizar la instalación por el hardware sobre el que lo vamos a realizar. En mi caso he seleccionado &ldquo;raspberrypi3-64&rdquo;</p><p>Ahora toca esperar un ratillo (En la Raspberry Pi 3 han sido más de 20 minutos) y ya podemos acceder a &ldquo;http://192.168.10.149:8123 para terminar con la instalación de Home Assistant</p></div><footer class=post__footer>
<div class="content post__content clearfix">
<h3>Otros de mís artículos que te pueden interesar</h3><ul>
<li><a href=/configuraci%C3%B3n-de-home-assistant-en-github/>Configuración de Home Assistant en github</a></li><li><a href=/sincronizar-google-photos-desde-la-raspberry/>Sincronizar Google Photos desde la Raspberry</a></li><li><a href=/usb-externo-controlado-desde-puerto-gpio/>Usb externo controlado desde puerto Gpio</a></li><li><a href=/reseteo-autom%C3%A1tico-de-home-assistant/>Reseteo automático de Home assistant</a></li><li><a href=/el-termostato-de-la-caldera-en-home-assistant/>El termostato de la caldera en Home Assistant</a></li></ul></div><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/docker/ rel=tag>docker</a>
</li></ul></div></footer></article></main><nav class="pager flex">
<div class="pager__item pager__item--prev">
<a class=pager__link href=/usb-externo-controlado-desde-puerto-gpio/ rel=prev>
<span class=pager__subtitle>«&#8201;Anterior</span>
<p class=pager__title>Usb externo controlado desde puerto Gpio</p></a>
</div><div class="pager__item pager__item--next">
<a class=pager__link href=/sincronizar-google-photos-desde-la-raspberry/ rel=next>
<span class=pager__subtitle>Siguiente&#8201;»</span>
<p class=pager__title>Sincronizar Google Photos desde la Raspberry</p></a>
</div></nav></div></div><footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2022 Sherlockes.
<span class=footer__copyright-credits>Generado con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> y <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span>
</br>Esta obra está bajo una <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>licencia de Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional</a>.</br></br><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Licencia de Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png></a>
</div></div></footer></div><script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script></body></html>