<!doctype html><html class=no-js lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Menú para montar nubes en Bash - Sherblog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Cuando las tareas, por sencillas que sean, son repetitivas lo mejor es automatizarlas."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.sherblog.pro/images/20191105_script_nubes_00.jpg"><meta name=twitter:title content="Menú para montar nubes en Bash"><meta name=twitter:description content="Cuando las tareas, por sencillas que sean, son repetitivas lo mejor es automatizarlas."><meta name=twitter:creator content="@sherblogpro"><meta name=twitter:site content="sherblog.pro"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><meta name=twitter:card content="summary"><meta name=twitter:title content="Menú para montar nubes en Bash"><meta name=twitter:description content="Cuando las tareas, por sencillas que sean, son repetitivas lo mejor es automatizarlas."><div class=container><div class=logo><a class=logo__link href=/ title=Sherblog rel=home><div class=logo__title>Sherblog</div><div class=logo__tagline>Sólo mi forma de hacer las cosas...</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menú</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/post/computing/emacs/><span class=menu__text>Emacs</span></a></li><li class=menu__item><a class=menu__link href=/post/computing/hugo/><span class=menu__text>Hugo</span></a></li><li class=menu__item><a class=menu__link href=/mis-v%C3%A9rtices-geod%C3%A9sicos/><span class=menu__text>Mis vértices geodésicos</span></a></li><li class=menu__item><a class=menu__link href=/post/computing/raspberry/><span class=menu__text>Raspberry Pi desde cero</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Menú para montar nubes en Bash</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-05-01T00:00:00Z>2020-05-01</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/varios/ rel=category>Varios</a></span></div></div></header><figure class="post__thumbnail thumbnail"><img class=thumbnail__image src=/images/20191105_script_nubes_00.jpg alt="Menú para montar nubes en Bash"></figure><div class="post__toc toc"><div class=toc__title>Índice</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#declaración-de-variables>Declaración de variables</a></li><li><a href=#allow-other>Allow-other</a></li><li><a href=#comprobación-de-montaje>Comprobación de montaje</a></li><li><a href=#mostrar-el-menú>Mostrar el menú</a></li><li><a href=#montar-y-desmontar-las-unidades>Montar y desmontar las unidades</a></li><li><a href=#captando-la-decisión-del-usuario>Captando la decisión del usuario</a></li><li><a href=#el-bucle-principal>El bucle principal</a></li></ul></nav></div></div><div class="content post__content clearfix"><p><strong>Actualización: Parámetro de rclone <a href=#allow-other>&ldquo;allow-other&rdquo;</a>.</strong> Ya hace un tiempo que vengo utilizando la terminal para montar las distintas nubes de las que hago uso a diario en mi terminal con <a href=https://linuxmint.com/>Linux Mint</a>. Ahora he creado un pequeño script en bash que me ahorra tiempo en esta operación y con el que he conseguido aprender abundantes conceptos en bas que a continuación paso a desgranar.</p><p>Puesto que este script va a estar en una continua modificación y mejora no lo voy a dejar aquí expuesto, si quieres descargarlo tan sólo tienes que acudir a mi repositorio en Github y descargar <a href=https://github.com/sherlockes/SherloScripts/blob/master/sherlomenu>Sherlomenu</a>.</p><h2 id=declaración-de-variables>Declaración de variables</h2><p>Por cada nube o carpeta remota que vaya a a montar como una unidad en mi unidad local voy a utilizar dos variables, una con la ruta donde voy a montar la unidad y otra con el comando necesario para montarla.</p><p>Por ejemplo, para el caso de <a href=https://mega.nz>Mega.nz</a> utilizo estas dos variables</p><pre tabindex=0><code>Mega_dir=~/Mega
Mega_cmd=&#39;rclone mount Sherlockes_Mega: $Mega_dir --daemon&#39;
</code></pre><p>Es importante que no se esté utilizando ya la ruta a la carpeta que se ha definido, ya que el script la borrará para asegurar un correcto montaje</p><h2 id=allow-other>Allow-other</h2><p>Entre las muchas [opciones] que tiene el comando &ldquo;mount&rdquo; de Rclone nos encontramos con &ndash;allow-other que se utiliza en caso de que varios usuarios puedan acceder a la unidad montada. Esta opción la uso en caso de montar la biblioteca multimedia pero me muestra el siguiente error</p><pre tabindex=0><code>mount helper error: fusermount: option allow_other only allowed if &#39;user_allow_other&#39; is set in /etc/fuse.conf
Fatal error: failed to mount FUSE fs: fusermount: exit status 1
</code></pre><p>Esto me ha resultado un profundo dolor de cabeza durante unas horas ya que si montamos la unidad como servicio usando combinadas las opciones &ldquo;Allow-other&rdquo; y &ldquo;Daemon&rdquo; entonces la unidad no se monta pero tampoco muestra ningún error por lo que es dificil detectarlo.</p><pre tabindex=0><code>rclone mount Sherloflix_en: $HOME/Sherloflix --allow-other --daemon
</code></pre><p>La solución, tal y como se muestra en el eror de arriba es bastante sencilla y basta con editar el archivo &ldquo;/etc/fuse.conf&rdquo; y quitar el comentario de la línea &ldquo;use_allow_other&rdquo; para que no sólo el usuario root tenga acceso a este parámetro de configuración.</p><h2 id=comprobación-de-montaje>Comprobación de montaje</h2><p>Esta es una función que se encarga de comprobar si la nube que le pasemos como argumento está o no ya montada. Tiene dos funciones</p><ul><li>Indicar si el script tiene que montar o desmontar la nube</li><li>Modificar el texto del menú en función del estado actual</li></ul><p>La función es la siguiente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>montado <span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    local carpeta<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>_dir&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> test -d <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> mountpoint -q <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>	    rm -rf <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Podemos ver como en un primer momento se declara la variable local &ldquo;carpeta&rdquo; y se le asigna la unión del primer argumento de la función y &ldquo;_dir&rdquo;. De esta forma, al lamar a <code>montado "Mega"</code> tendremos como valor de la variable &ldquo;carpeta&rdquo; a &ldquo;Mega_dir&rdquo; de la que a continuación haremos uso a través de las variables indirectas.</p><blockquote><p>Gracias al uso de variables indirectas es posible obtener el valor de una variable a partir de otra cuyo valor es el nombre de la primera.</p></blockquote><p>El primer condicional comienza comprobando la esistencia de &ldquo;carpeta&rdquo; como una ruta existente mediante el comando <code>test</code>. Si la carpeta existe, comprueba si esta está montada y si es así devuelve &ldquo;0&rdquo;, si no está montada la borra y devuelve &ldquo;1&rdquo;. Si la carpeta no existe directamente devuelve &ldquo;1&rdquo;</p><h2 id=mostrar-el-menú>Mostrar el menú</h2><p>Simplemente una serie de &ldquo;echos&rdquo; anidados que nos mostrará en unas pocas líneas las opciones de las que disponemos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>show_menus<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    clear
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;------------------------------------&#34;</span>	
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;--------  www.sherblog.pro  --------&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;------------------------------------&#34;</span>
</span></span><span style=display:flex><span>    montado <span style=color:#e6db74>&#34;Sherloflix&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;-- 1. Sherloflix (Desmontar)      --&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;-- 1. Sherloflix                  --&#34;</span>
</span></span><span style=display:flex><span>    montado <span style=color:#e6db74>&#34;Mega&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;-- 2. Mega (Desmontar)            --&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;-- 2. Mega                        --&#34;</span>
</span></span><span style=display:flex><span>    montado <span style=color:#e6db74>&#34;VideoNas&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;-- 3. Videos en Nas (Desmontar)   --&#34;</span> <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;-- 3. Videos en Ds216+ II         --&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;-- 4. Backup de Google Photos     --&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;-- 5. Salir                       --&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;------------------------------------&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>En un primer momento borra la pantalla para posteriormente escribir nuevamente el menú. En el caso de las nubes se ha usado una estructura de condicional en una sola linea para comprobar en estado de la nube y así mostrar la descripción de lo que hará el comando en caso de seleccionarlo, es decir, aparecerá &ldquo;Desmontar&rdquo; en caso de que la nube ya esté montada.</p><blockquote><p>Las condicionales en uns sólo línea se basan en la siguiente estructura:
condicion && si_se_cumple || si_no_se_cumple</p></blockquote><h2 id=montar-y-desmontar-las-unidades>Montar y desmontar las unidades</h2><p>En la mayoría de los casos que hasta ahora utilizo el montaje de la unidad es tan sencillo como crear la carpeta y ejecutar un comando , la operación inversa pasa por el desmontaje de la carpeta y una posterior eliminación de la misma. Según esto, he creado una función que de forma genérica realiza estas funciones para los distintos casos en función de los argumentos que se le pasen.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>des_montar<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    local carpeta<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>_dir&#34;</span>
</span></span><span style=display:flex><span>    local comando<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>_cmd&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> montado $1;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Desmontando </span>$1<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>        fusermount -u <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Se va a eliminar la carpeta contenedora...&#34;</span>
</span></span><span style=display:flex><span>        rm -rf <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Montando </span>$1<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>        mkdir <span style=color:#e6db74>${</span>!carpeta<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>        eval <span style=color:#e6db74>${</span>!comando<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>El condicional comprueba si el argmento que le pasamos a la función está ya montado. Si está montado procede a desmontar la unidad y borrar la carpeta. Si no lo está, crea la carpeta y ejecuta el comando personalizado.</p><blockquote><p>Gracias al uso de variables indirectas y del comando &ldquo;eval&rdquo; podemos guardar dentro de una variable externa a la función un comando y ejecuarlo posteriormente</p></blockquote><h2 id=captando-la-decisión-del-usuario>Captando la decisión del usuario</h2><p>El script deba captar lo que el usuario quiere hacer, para ello se hace uso de la variable &ldquo;choice&rdquo; y del comando &ldquo;read&rdquo; que combinados nos permiten realizar una función distinta para las distintas posibilidades.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>read_options<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    local choice
</span></span><span style=display:flex><span>    read -p <span style=color:#e6db74>&#34;Selecciona una opción [ 1 - 5] &#34;</span> choice
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> $choice in
</span></span><span style=display:flex><span>		1<span style=color:#f92672>)</span> des_montar <span style=color:#e6db74>&#34;Sherloflix&#34;</span> ;;
</span></span><span style=display:flex><span>		2<span style=color:#f92672>)</span> des_montar <span style=color:#e6db74>&#34;Mega&#34;</span> ;;
</span></span><span style=display:flex><span>        3<span style=color:#f92672>)</span> des_montar <span style=color:#e6db74>&#34;VideoNas&#34;</span> ;;
</span></span><span style=display:flex><span>        4<span style=color:#f92672>)</span> Google_Photos ;;      
</span></span><span style=display:flex><span>	5<span style=color:#f92672>)</span> exit 0;;
</span></span><span style=display:flex><span>	*<span style=color:#f92672>)</span> echo -e <span style=color:#e6db74>&#34;...Error...&#34;</span> <span style=color:#f92672>&amp;&amp;</span> sleep <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Hay una opción para casa nube, una opción para salir y un error que mostrar en caso de que selecciones alguna opción distinta a las previstas.</p><h2 id=el-bucle-principal>El bucle principal</h2><p>Un simple &ldquo;while true&rdquo; que se ejecuta indefinidamente.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>while</span> true
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    show_menus
</span></span><span style=display:flex><span>    read_options
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>[opciones] : <a href=https://rclone.org/commands/rclone_mount/>https://rclone.org/commands/rclone_mount/</a></p></div><footer class=post__footer><div class="content post__content clearfix"><h3>Otros de mís artículos que te pueden interesar</h3><ul><li><a href=/instalar-rclone-en-synology-ds920-/>Instalar rclone en Synology Ds920+</a></li><li><a href=/cambiar-el-orden-de-los-elementos-del-grub/>Cambiar el orden de los elementos del grub</a></li><li><a href=/script-de-configuraci%C3%B3n-para-raspberry/>Script de configuración para Raspberry</a></li><li><a href=/controlar-las-luces-de-philips-hue-con-un-script-en-bash/>Controlar las luces de Philips hue con un script en bash</a></li><li><a href=/unir-o-separar-en-varios-pdf-en-linux-desde-la-l%C3%ADnea-de-comandos/>Unir o separar en varios pdf en linux desde la línea de comandos</a></li></ul></div><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/bash/ rel=tag>bash</a></li><li class=tags__item><a class="tags__link btn" href=/tags/rclone/ rel=tag>rclone</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/los-podcast-que-escucho.-abril-de-2020/ rel=prev><span class=pager__subtitle>«&#8201;Anterior</span><p class=pager__title>Los podcast que escucho. Abril de 2020</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/encender-el-nas-desde-el-tel%C3%A9fono/ rel=next><span class=pager__subtitle>Siguiente&#8201;»</span><p class=pager__title>Encender el Nas desde el teléfono</p></a></div></nav><div class="content post__content clearfix"><h3>Comentarios</h3>Atrás quedaron los tiempos de los comentarios en el propio blog. La ley de protección de datos y el spam pudieron con ellos. Ahora puedes plantearme cualquier duda, comentario o sugerencia en <a href=https://twitter.com/sherblogpro>@sherlockes</a> en Twitter o Telegram.</div></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 Sherlockes.
<span class=footer__copyright-credits>Generado con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> y <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></br>Esta obra está bajo una <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>licencia de Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional</a>.</br></br><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Licencia de Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png></a></div></div></footer></div><script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script></body></html>